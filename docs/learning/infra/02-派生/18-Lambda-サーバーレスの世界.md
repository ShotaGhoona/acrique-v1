# 18: Lambda - サーバーレスの世界

## サーバーレスとは？

**サーバーを管理せずにコードを実行する仕組み**

```
従来（ECS）:
  サーバーを24時間起動 → 使わなくても課金

サーバーレス（Lambda）:
  リクエストが来たときだけ起動 → 使った分だけ課金
```

---

## AWS Lambdaとは？

**イベント駆動でコードを実行するサービス**

### 特徴
- **起動時間**: 数ミリ秒〜数秒
- **実行時間**: 最大15分
- **メモリ**: 128MB〜10GB
- **言語**: Node.js, Python, Go, Java, etc.

---

## ACRIQUEでの活用例

### 今は使っていない理由
```
ACRIQUE = ECサイト
  → 常時リクエストがある
  → ECS（常時起動）の方が効率的
```

### 使うならこんな場面
```typescript
// 例: 商品画像のリサイズ
export const handler = async (event) => {
  const image = event.Records[0].s3.object.key;
  // S3に画像がアップロードされたら自動リサイズ
  await resizeImage(image);
};
```

---

## Lambdaが向いているケース

| ユースケース | 理由 |
|-------------|------|
| 画像処理 | アップロード時だけ実行 |
| メール送信 | 注文時だけ実行 |
| バッチ処理 | 定期実行（1日1回など） |
| Webhook | 外部連携時だけ実行 |
| API Gateway連携 | 軽量なAPI |

---

## Lambdaが向いていないケース

| ユースケース | 理由 |
|-------------|------|
| 常時リクエスト | コールドスタートが問題 |
| 長時間処理 | 15分制限 |
| ステートフル | 毎回初期化される |
| WebSocket | 常時接続が必要 |

---

## コールドスタート問題

```
初回リクエスト: コンテナ起動（1-3秒）→ 処理
2回目以降:     即座に処理（ウォーム状態）

しばらく放置: コンテナ破棄 → また1からスタート
```

**対策**: Provisioned Concurrency（常時ウォーム）

---

## 料金（めちゃくちゃ安い）

| 項目 | 無料枠 |
|------|-------|
| リクエスト | 100万回/月 |
| 実行時間 | 40万GB秒/月 |

**例**: 1秒で終わる処理を月10万回実行 → **無料**

---

## ECS vs Lambda

| 比較 | ECS | Lambda |
|------|-----|--------|
| 課金 | 常時 | 実行時のみ |
| 起動 | 即座 | コールドスタートあり |
| 実行時間 | 無制限 | 最大15分 |
| スケール | 設定が必要 | 自動 |
| 適用 | メインAPI | イベント処理 |

---

## 次のステップ
- [19: API Gateway - APIの入り口](./19-APIGateway-APIの入り口.md)
