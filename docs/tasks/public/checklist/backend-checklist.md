# Backend タスクチェックリスト

ドメイン × レイヤー（オニオンアーキテクチャ）で管理

---

## 凡例

- ⬜ 未着手
- ✅ 完了

レイヤー: **D**omain / **A**pplication / **I**nfrastructure / **P**resentation

---

## Auth（認証）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | 会員登録 |
| ✅ | ✅ | ✅ | ✅ | ログイン |
| ✅ | ✅ | ✅ | ✅ | ログアウト |
| ✅ | ✅ | ✅ | ✅ | 認証状態確認 |
| ✅ | ✅ | ✅ | ✅ | パスワードリセット依頼 |
| ✅ | ✅ | ✅ | ✅ | パスワード再設定 |
| ✅ | ✅ | ✅ | ✅ | メール認証 |

---

## Users（ユーザー）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | 自分の情報取得 |
| ✅ | ✅ | ✅ | ✅ | 自分の情報更新 |
| ✅ | ✅ | ✅ | ✅ | パスワード変更 |

---

## Addresses（配送先）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | 配送先一覧 |
| ✅ | ✅ | ✅ | ✅ | 配送先追加 |
| ✅ | ✅ | ✅ | ✅ | 配送先詳細 |
| ✅ | ✅ | ✅ | ✅ | 配送先更新 |
| ✅ | ✅ | ✅ | ✅ | 配送先削除 |
| ✅ | ✅ | ✅ | ✅ | デフォルト設定 |

---

## Products（商品）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | 商品一覧 |
| ✅ | ✅ | ✅ | ✅ | 商品詳細 |
| ✅ | ✅ | ✅ | ✅ | 商品オプション一覧 |
| ✅ | ✅ | ✅ | ✅ | 関連商品 |
| ✅ | ✅ | ✅ | ✅ | おすすめ商品 |
| ✅ | ✅ | ✅ | ✅ | 商品検索 |

---

## Cart（カート）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | カート内容取得 |
| ✅ | ✅ | ✅ | ✅ | カートに追加 |
| ✅ | ✅ | ✅ | ✅ | カート商品更新 |
| ✅ | ✅ | ✅ | ✅ | カートから削除 |
| ✅ | ✅ | ✅ | ✅ | カートを空にする |

---

## Orders（注文）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | 注文一覧 |
| ✅ | ✅ | ✅ | ✅ | 注文作成 |
| ✅ | ✅ | ✅ | ✅ | 注文詳細 |
| ✅ | ✅ | ✅ | ✅ | 注文キャンセル |

---

## Uploads（入稿）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | 入稿データ一覧 |
| ✅ | ✅ | ✅ | ✅ | ファイルアップロード |
| ✅ | ✅ | ✅ | ✅ | 入稿データ詳細 |
| ✅ | ✅ | ✅ | ✅ | 入稿データ削除 |
| ✅ | ✅ | ✅ | ✅ | 注文への入稿 |

---

## Payments（決済）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | PaymentIntent作成 |
| ✅ | ✅ | ✅ | ✅ | Stripe Webhook |

---

## Contact（お問い合わせ）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ⬜ | ⬜ | ⬜ | ⬜ | お問い合わせ送信 |

---

# Admin API

---

## Admin Auth（管理者認証）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | 管理者ログイン |
| ✅ | ✅ | ✅ | ✅ | 管理者ログアウト |
| ✅ | ✅ | ✅ | ✅ | 認証状態確認 |

---

## Admin Dashboard（ダッシュボード）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | ダッシュボード情報 |
| ✅ | ✅ | ✅ | ✅ | 売上統計 |

---

## Admin Orders（注文管理）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | 注文一覧 |
| ✅ | ✅ | ✅ | ✅ | 注文詳細 |
| ✅ | ✅ | ✅ | ✅ | 注文更新 |
| ✅ | ✅ | ✅ | ✅ | ステータス更新 |
| ✅ | ✅ | ✅ | ✅ | 発送処理 |

---

## Admin Products（商品管理）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | 商品一覧 |
| ✅ | ✅ | ✅ | ✅ | 商品追加 |
| ✅ | ✅ | ✅ | ✅ | 商品詳細 |
| ✅ | ✅ | ✅ | ✅ | 商品更新 |
| ✅ | ✅ | ✅ | ✅ | 商品削除 |
| ✅ | ✅ | ✅ | ✅ | 画像追加 |
| ✅ | ✅ | ✅ | ✅ | 画像削除 |
| ✅ | ✅ | ✅ | ✅ | オプション更新 |
| ✅ | ✅ | ✅ | ✅ | スペック更新 |
| ✅ | ✅ | ✅ | ✅ | 特長更新 |
| ✅ | ✅ | ✅ | ✅ | FAQ更新 |

---

## Admin Uploads（入稿管理）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | 入稿データ一覧 |
| ✅ | ✅ | ✅ | ✅ | 入稿データ詳細 |
| ✅ | ✅ | ✅ | ✅ | 承認 |
| ✅ | ✅ | ✅ | ✅ | 差し戻し |

---

## Admin Users（顧客管理）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | 顧客一覧 |
| ✅ | ✅ | ✅ | ✅ | 顧客詳細 |
| ✅ | ✅ | ✅ | ✅ | 顧客の注文履歴 |

---

## Admin Admins（管理者管理）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | 管理者一覧 |
| ✅ | ✅ | ✅ | ✅ | 管理者追加 |
| ✅ | ✅ | ✅ | ✅ | 管理者更新 |
| ✅ | ✅ | ✅ | ✅ | 管理者削除 |

---

## Admin Logs（操作ログ）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ✅ | ✅ | ✅ | ✅ | 操作ログ一覧 |

---

## Admin Settings（サイト設定）

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ⬜ | ⬜ | ⬜ | ⬜ | 設定取得 |
| ⬜ | ⬜ | ⬜ | ⬜ | 設定更新 |

---

# 共通基盤

| 状況 | タスク |
|------|--------|
| ✅ | DB マイグレーション設定 |
| ✅ | 認証ミドルウェア |
| ✅ | 管理者認証ミドルウェア |
| ✅ | エラーハンドリング |
| ✅ | バリデーション共通処理 |
| ✅ | ロギング |
| ✅ | Stripe連携設定 |
| ✅ | S3連携設定 |
| ✅ | メール送信設定 |

---

# Product Master 導入

| D | A | I | P | タスク |
|---|---|---|---|--------|
| ⬜ | ⬜ | ⬜ | - | product_master テーブル作成（マイグレーション） |
| ⬜ | ⬜ | ⬜ | - | products に master_id, production_type, upload_requirements 追加 |
| ⬜ | ⬜ | - | - | ProductMaster エンティティ作成 |
| ⬜ | ⬜ | - | - | Product エンティティに新フィールド追加 |
| ⬜ | - | ⬜ | - | ProductMaster リポジトリ作成 |
| ⬜ | - | ⬜ | - | Product リポジトリ更新（新フィールド対応） |
| - | ⬜ | - | - | 入稿要否判定ロジック変更（production_type !== 'standard'） |
| - | - | - | ⬜ | GET /api/masters エンドポイント（任意） |
| - | - | - | ⬜ | Admin Masters CRUD エンドポイント（任意） |
| ⬜ | ⬜ | ⬜ | - | 既存データ移行（requires_upload → production_type） |
| - | - | ⬜ | - | 旧カラム削除（requires_upload, upload_type, upload_note） |

---

# リファクタリング

| 状況 | タスク | 備考 |
|------|--------|------|
| ⬜ | 税込価格への統一 | 消費税計算ロジックを削除し、全ての価格を税込で扱うように変更。Cart等の`tax`フィールドを廃止 |
