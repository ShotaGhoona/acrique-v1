# 04-1: CDKデプロイログの読み方

## デプロイの進捗を確認する

### 1. スタック進捗の見方
```
dev-acrique-v1-BackendStack: deploying... [6/8]
                                           ↑
                                      8個中6個目
```

### 2. リソース作成状況
```
 0/45 | 3:45:00 PM | CREATE_IN_PROGRESS   | AWS::RDS::DBInstance
15/45 | 3:50:00 PM | CREATE_COMPLETE      | AWS::RDS::DBInstance
 ↑
この数字が増えていけばOK
```

### 3. 完了の目印
```
✅ dev-ObjectStorageStack

Outputs:
BucketName: dev-acrique-v1-data-xxxxx
```
`✅` マークが出たらそのスタック完了！

---

## ACRIQUEの8つのスタック

| # | スタック名 | 役割 | 所要時間 |
|---|-----------|------|---------|
| 1 | FoundationStack | VPC、サブネット、NAT Gateway | 5-10分 |
| 2 | SecurityStack | IAMロール、セキュリティグループ | 1-2分 |
| 3 | DataStorageStack | RDS PostgreSQL | 10-15分 |
| 4 | ObjectStorageStack | S3バケット | 1分 |
| 5 | IntegrationStack | Secrets Manager | 1分 |
| 6 | BackendStack | ECS Fargate、ALB | 5-10分 |
| 7 | FrontendStack | Amplify | 2-3分 |
| 8 | ObservabilityStack | CloudWatch監視 | 1分 |

**合計**: 約30-40分

---

## スタックの依存関係

```
FoundationStack（VPC）
    ↓
SecurityStack（セキュリティ）
    ↓
┌───────────────┬─────────────────┐
↓               ↓                 ↓
DataStorage   ObjectStorage   Integration
(RDS)         (S3)            (Secrets)
    ↓               ↓              ↓
    └───────────────┴──────────────┘
                ↓
          BackendStack（ECS）
                ↓
          FrontendStack（Amplify）
                ↓
          ObservabilityStack（監視）
```

**ポイント**: 上が終わらないと下は始まらない

---

## よくあるログメッセージ

| メッセージ | 意味 |
|-----------|------|
| `CREATE_IN_PROGRESS` | 作成中 |
| `CREATE_COMPLETE` | 作成完了 |
| `CREATE_FAILED` | 作成失敗（エラー内容を確認） |
| `UPDATE_IN_PROGRESS` | 更新中（2回目以降のデプロイ） |
| `DELETE_IN_PROGRESS` | 削除中（destroy時） |

---

## エラーが出たら

1. **赤い文字を探す** → エラーメッセージ
2. **`FAILED`を探す** → どのリソースで失敗したか
3. **スタック名を確認** → どの段階で止まったか

```
❌ dev-acrique-v1-DataStorageStack failed
Resource handler returned message: "..."
                                    ↑
                                ここがエラー原因
```

---

## 次のステップ
- [04-2: CDKコマンド一覧](./04-2-CDKコマンド一覧.md)（作成予定）
