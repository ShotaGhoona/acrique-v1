# å…¥ç¨¿ãƒ•ãƒ­ãƒ¼æ”¹å–„ å®Ÿè£…æˆ¦ç•¥æ›¸

## æ¦‚è¦

ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆæ™‚ã®å…¥ç¨¿ãƒ•ãƒ­ãƒ¼ã‚’è¦ä»¶å®šç¾©ï¼ˆ21-data-upload-flow.mdï¼‰ã«åˆã‚ã›ã¦æ”¹å–„ã™ã‚‹ã€‚

**æ ¸ã¨ãªã‚‹è¦ä»¶**:
- å…¥ç¨¿å¿…è¦å•†å“ã¯ã€**å…¨æ•°é‡åˆ†ã®å…¥ç¨¿ãŒå®Œäº†ã—ãªã„ã¨æ”¯æ‰•ã„ã«é€²ã‚ãªã„**
- ãƒã‚¤ãƒšãƒ¼ã‚¸ã§ã®å…¥ç¨¿ã¯**å·®ã—æˆ»ã—æ™‚ã®ã¿**ç™ºç”Ÿ

---

## ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³

### å®Ÿè£…æ¸ˆã¿

| æ©Ÿèƒ½ | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ |
|------|---------|------|
| S3 Presigned URL å–å¾— | `upload_api.py` | âœ… |
| S3 ç›´æ¥ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ | `use-upload-file.ts` | âœ… |
| ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†ç™»éŒ² | `upload_api.py` | âœ… |
| æ³¨æ–‡æ˜ç´°ã¸ã®ç´ä»˜ã‘ | `upload_usecase.py` | âœ… |
| æ”¯æ‰•ã„æˆåŠŸæ™‚ã®å…¥ç¨¿è¦å¦åˆ¤å®š | `payment_usecase.py` | âœ… |
| å…¥ç¨¿ç”»é¢ UI | `CheckoutUploadContainer.tsx` | âœ…ï¼ˆãŸã ã—ä¸å®Œå…¨ï¼‰ |

### æœªå®Ÿè£…ãƒ»ä¸å®Œå…¨

| æ©Ÿèƒ½ | å•é¡Œ | å„ªå…ˆåº¦ |
|------|------|--------|
| `quantity_index` ã‚«ãƒ©ãƒ  | DB ã«å­˜åœ¨ã—ãªã„ | ğŸ”´ Critical |
| æ•°é‡åˆ†ã®å…¥ç¨¿ã‚¹ãƒ­ãƒƒãƒˆè¡¨ç¤º | 1å•†å“=1ã‚¹ãƒ­ãƒƒãƒˆã®ã¿ | ğŸ”´ Critical |
| `revision_required` ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å­˜åœ¨ã—ãªã„ | ğŸ”´ Critical |
| `reviewing` ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | `DATA_REVIEWING` ã§å®Ÿè£…ï¼ˆè¦ãƒªãƒãƒ¼ãƒ ï¼‰ | ğŸŸ¡ Medium |
| Admin å¯©æŸ» API | UI ã¯ã‚ã‚‹ãŒæœªå®Ÿè£… | ğŸŸ¡ Medium |
| ãƒã‚¤ãƒšãƒ¼ã‚¸å†å…¥ç¨¿ãƒ•ãƒ­ãƒ¼ | æœªå®Ÿè£… | ğŸŸ¡ Medium |
| å…¥ç¨¿å®Œäº†ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | å…¨æ•°é‡åˆ†ãƒã‚§ãƒƒã‚¯ãªã— | ğŸ”´ Critical |

---

## å®Ÿè£…ã‚®ãƒ£ãƒƒãƒ—è©³ç´°

### Gap 1: `quantity_index` ã®æ¬ è½

**ç¾çŠ¶ã® uploads ãƒ†ãƒ¼ãƒ–ãƒ«**:
```python
# backend/app/infrastructure/db/models/upload_model.py
class UploadModel(Base):
    order_item_id = Column(Integer, ForeignKey('order_items.id'))
    # quantity_index ãŒãªã„!
```

**å•é¡Œ**: åŒä¸€å•†å“ã‚’3å€‹æ³¨æ–‡ã—ãŸå ´åˆã€ã€Œä½•å€‹ç›®ã®å…¥ç¨¿ã‹ã€ã‚’åŒºåˆ¥ã§ããªã„

**è§£æ±ºç­–**: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ `quantity_index` ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 

---

### Gap 2: æ•°é‡åˆ†ã®å…¥ç¨¿ã‚¹ãƒ­ãƒƒãƒˆæœªè¡¨ç¤º

**ç¾çŠ¶ã®å®Ÿè£…** (`CheckoutUploadContainer.tsx:187-220`):
```typescript
{order.items.map((item) => (
  <FileDropzone />  // 1å•†å“=1ã‚¹ãƒ­ãƒƒãƒˆã®ã¿
))}
```

**è¦ä»¶**: å•†å“ã‚’3å€‹è²·ã£ãŸã‚‰ã€å…¥ç¨¿ã‚¨ãƒªã‚¢ã‚’3ã¤è¡¨ç¤º

**è§£æ±ºç­–**: `item.quantity` åˆ†ãƒ«ãƒ¼ãƒ—ã—ã¦ Dropzone ã‚’ç”Ÿæˆ

---

### Gap 3: `revision_required` ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå­˜åœ¨ã—ãªã„

**ç¾çŠ¶ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å®šç¾©** (`order.py`):
```python
class OrderStatus(str, Enum):
    PENDING = 'pending'
    AWAITING_PAYMENT = 'awaiting_payment'  # å‰Šé™¤äºˆå®š
    PAID = 'paid'                          # å‰Šé™¤äºˆå®š
    AWAITING_DATA = 'awaiting_data'        # å‰Šé™¤äºˆå®š
    DATA_REVIEWING = 'data_reviewing'      # reviewing ã«ãƒªãƒãƒ¼ãƒ 
    CONFIRMED = 'confirmed'
    PROCESSING = 'processing'
    SHIPPED = 'shipped'
    DELIVERED = 'delivered'
    CANCELLED = 'cancelled'
```

**è¦ä»¶ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**:
```python
class OrderStatus(str, Enum):
    PENDING = 'pending'
    REVIEWING = 'reviewing'              # æ–°è¦ï¼ˆDATA_REVIEWING ã‹ã‚‰å¤‰æ›´ï¼‰
    REVISION_REQUIRED = 'revision_required'  # æ–°è¦
    CONFIRMED = 'confirmed'
    PROCESSING = 'processing'
    SHIPPED = 'shipped'
    DELIVERED = 'delivered'
    CANCELLED = 'cancelled'
```

---

### Gap 4: å…¥ç¨¿å®Œäº†ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãªã—

**ç¾çŠ¶**: å…¥ç¨¿ã›ãšã«ç¢ºèªç”»é¢ã¸é€²ã‚ã‚‹ï¼ˆã‚¹ã‚­ãƒƒãƒ—å¯èƒ½ï¼‰

**è¦ä»¶**: å…¥ç¨¿å¿…è¦å•†å“ãŒã‚ã‚‹å ´åˆã€å…¨æ•°é‡åˆ†ã®å…¥ç¨¿ãŒå®Œäº†ã—ãªã„ã¨æ”¯æ‰•ã„ã«é€²ã‚ãªã„

**è§£æ±ºç­–**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 

```typescript
function canProceedToPayment(order: Order, uploads: Upload[]): boolean {
  for (const item of order.items) {
    if (!item.requires_upload) continue;

    for (let i = 1; i <= item.quantity; i++) {
      const hasUpload = uploads.some(
        u => u.orderItemId === item.id && u.quantityIndex === i
      );
      if (!hasUpload) return false;
    }
  }
  return true;
}
```

---

### Gap 5: Admin å¯©æŸ»ãƒ•ãƒ­ãƒ¼æœªå®Ÿè£…

**ç¾çŠ¶** (`AdminUploadDetailContainer.tsx`):
```typescript
const handleApprove = () => {
  alert('æ‰¿èªã—ã¾ã—ãŸï¼ˆæœªå®Ÿè£…ï¼‰');  // TODO
};
```

**å¿…è¦ãªå®Ÿè£…**:
1. `POST /api/admin/uploads/{id}/approve` - æ‰¿èª API
2. `POST /api/admin/uploads/{id}/reject` - å·®ã—æˆ»ã— API
3. å…¨å…¥ç¨¿æ‰¿èªæ™‚ã«æ³¨æ–‡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ `confirmed` ã«æ›´æ–°
4. 1ã¤ã§ã‚‚å·®ã—æˆ»ã—æ™‚ã«æ³¨æ–‡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ `revision_required` ã«æ›´æ–°

---

## å¤‰æ›´è¦ä»¶

### è¦ä»¶1: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ•´ç†

**å‰Šé™¤ã™ã‚‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**:
- `awaiting_payment` - `pending` ã«çµ±åˆ
- `paid` - ä¸è¦ï¼ˆ`paid_at` ã§è¨˜éŒ²ï¼‰
- `awaiting_data` - å‰Šé™¤ï¼ˆãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆæ™‚ã¯å…¥ç¨¿å¿…é ˆãªã®ã§ç™ºç”Ÿã—ãªã„ï¼‰

**å¤‰æ›´ã™ã‚‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**:
- `data_reviewing` â†’ `reviewing`

**è¿½åŠ ã™ã‚‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**:
- `revision_required` - Admin å·®ã—æˆ»ã—å¾Œ

### è¦ä»¶2: æ•°é‡åˆ†ã®å…¥ç¨¿å¯¾å¿œ

- `uploads` ãƒ†ãƒ¼ãƒ–ãƒ«ã« `quantity_index` ã‚«ãƒ©ãƒ è¿½åŠ 
- å…¥ç¨¿ç”»é¢ã§æ•°é‡åˆ†ã®ã‚¹ãƒ­ãƒƒãƒˆã‚’è¡¨ç¤º
- ç´ä»˜ã‘ API ã« `quantity_index` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ 

### è¦ä»¶3: å…¥ç¨¿å®Œäº†ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

- å…¥ç¨¿å¿…è¦å•†å“ãŒã‚ã‚‹å ´åˆã€å…¨æ•°é‡åˆ†ã®å…¥ç¨¿ãŒå®Œäº†ã—ãªã„ã¨ç¢ºèªç”»é¢ã«é€²ã‚ãªã„
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

### è¦ä»¶4: Admin å¯©æŸ»ãƒ•ãƒ­ãƒ¼å®Ÿè£…

- æ‰¿èª/å·®ã—æˆ»ã— API å®Ÿè£…
- å…¨æ‰¿èªæ™‚ â†’ `confirmed`
- å·®ã—æˆ»ã—æ™‚ â†’ `revision_required`

### è¦ä»¶5: ãƒã‚¤ãƒšãƒ¼ã‚¸å†å…¥ç¨¿ãƒ•ãƒ­ãƒ¼å®Ÿè£…

- `revision_required` ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ³¨æ–‡ã§å†å…¥ç¨¿ãƒœã‚¿ãƒ³è¡¨ç¤º
- å·®ã—æˆ»ã—ç†ç”±ã®è¡¨ç¤º
- å†å…¥ç¨¿å¾Œ â†’ `reviewing`

---

## å®Ÿè£…æ™‚ã«èª­ã‚€ã¹ãæ—¢å­˜ã‚³ãƒ¼ãƒ‰

### Backend

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|----------|------|
| `app/domain/entities/order.py` | OrderStatus å®šç¾©ã€‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ç®‡æ‰€ |
| `app/infrastructure/db/models/order_model.py` | DB ãƒ¢ãƒ‡ãƒ«ã€‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ç®‡æ‰€ |
| `app/infrastructure/db/models/upload_model.py` | uploads ãƒ†ãƒ¼ãƒ–ãƒ«ã€‚quantity_index è¿½åŠ ç®‡æ‰€ |
| `app/domain/entities/upload.py` | Upload ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€‚quantity_index è¿½åŠ ç®‡æ‰€ |
| `app/application/schemas/order_schemas.py` | OrderItemDTOã€‚requires_upload è¿½åŠ ç®‡æ‰€ |
| `app/application/use_cases/order_usecase.py` | æ³¨æ–‡ä½œæˆãƒ­ã‚¸ãƒƒã‚¯ |
| `app/application/use_cases/upload_usecase.py` | å…¥ç¨¿ç´ä»˜ã‘ãƒ­ã‚¸ãƒƒã‚¯ |
| `app/application/use_cases/payment_usecase.py` | æ”¯æ‰•ã„æˆåŠŸæ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ±ºå®š |
| `app/presentation/api/admin/upload_api.py` | Admin å¯©æŸ» API è¿½åŠ ç®‡æ‰€ |

### Frontend

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|----------|------|
| `src/entities/order/model/types.ts` | OrderItem å‹ã€‚requires_upload è¿½åŠ ç®‡æ‰€ |
| `src/page-components/purchase/checkout/home/ui/CheckoutContainer.tsx` | é·ç§»ãƒ­ã‚¸ãƒƒã‚¯ä¿®æ­£ç®‡æ‰€ |
| `src/page-components/purchase/checkout/upload/ui/CheckoutUploadContainer.tsx` | å…¥ç¨¿ UI å…¨ä½“ã®ä¿®æ­£ç®‡æ‰€ |
| `src/page-components/mypage/order-upload/ui/OrderUploadContainer.tsx` | ãƒã‚¤ãƒšãƒ¼ã‚¸å†å…¥ç¨¿ UI |
| `src/features/upload/link-uploads/lib/use-link-uploads.ts` | ç´ä»˜ã‘ API ãƒ•ãƒƒã‚¯ |

---

## DBå¤‰æ›´

### 1. uploads ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚«ãƒ©ãƒ è¿½åŠ 

```sql
ALTER TABLE uploads ADD COLUMN quantity_index INTEGER DEFAULT 1;
CREATE INDEX ix_uploads_order_item_quantity ON uploads(order_item_id, quantity_index);
```

### 2. orders ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å€¤æ›´æ–°

```sql
-- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œ
UPDATE orders SET status = 'reviewing' WHERE status = 'data_reviewing';
UPDATE orders SET status = 'pending' WHERE status IN ('awaiting_payment', 'paid', 'awaiting_data');
```

---

## å®Ÿè£…æ‰‹é †ï¼ˆæ¨å¥¨é †åºï¼‰

### Phase 1: DBãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´

1. âœ… è¦ä»¶ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´åˆæ€§ç¢ºèªï¼ˆå®Œäº†ï¼‰
2. âœ… `OrderStatus` enum ã‚’æ›´æ–°ï¼ˆorder.py, order_model.pyï¼‰
3. âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆï¼ˆquantity_index è¿½åŠ  + ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å€¤ç§»è¡Œï¼‰
4. âœ… `Upload` ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã« `quantity_index` è¿½åŠ 
5. âœ… Frontend å‹å®šç¾©ãƒ»UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ›´æ–°
6. âœ… ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å®šæ•°ã‚’ shared ã«é›†ç´„

### Phase 2: Backend API ä¿®æ­£

1. âœ… `OrderItemDTO` ã« `requires_upload`, `upload_type` è¿½åŠ 
2. âœ… `order_usecase.py` ã§å•†å“ã®å…¥ç¨¿æƒ…å ±ã‚’ DTO ã«å«ã‚ã‚‹
3. âœ… ç´ä»˜ã‘ API ã« `quantity_index` å¯¾å¿œ
4. âœ… `payment_usecase.py` ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ±ºå®šãƒ­ã‚¸ãƒƒã‚¯ç¢ºèªï¼ˆæ—¢ã«æ­£ã—ãå®Ÿè£…æ¸ˆã¿ï¼‰
5. [ ] Admin å¯©æŸ» API å®Ÿè£…ï¼ˆapprove/rejectï¼‰â€»æ–°è¦APIã€åˆ¥ã‚¿ã‚¹ã‚¯

### Phase 3: Frontend ä¿®æ­£

1. [x] `OrderItem` å‹ã« `requires_upload`, `upload_type` è¿½åŠ 
2. [x] `CheckoutContainer` ã§å…¥ç¨¿è¦å¦ã‚’åˆ¤å®šã—ã¦é·ç§»å…ˆã‚’åˆ†å²
3. [x] `CheckoutUploadContainer` ã‚’å…¨é¢æ”¹ä¿®
   - å…¥ç¨¿å¿…è¦ãªå•†å“ã®ã¿è¡¨ç¤º
   - æ•°é‡åˆ†ã®å…¥ç¨¿ã‚¨ãƒªã‚¢ã‚’ç”Ÿæˆ
   - å…¨å…¥ç¨¿å®Œäº†ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
4. [x] `useLinkUploads` ãƒ•ãƒƒã‚¯ã« `quantity_index` å¯¾å¿œ
5. [ ] ãƒã‚¤ãƒšãƒ¼ã‚¸å†å…¥ç¨¿ç”»é¢å®Ÿè£…ï¼ˆPhase 4 ã¸ç§»å‹•ï¼‰

### Phase 4: Admin ç”»é¢

1. [ ] å¯©æŸ»ç”»é¢ã®æ‰¿èª/å·®ã—æˆ»ã—ãƒœã‚¿ãƒ³å®Ÿè£…
2. [ ] å·®ã—æˆ»ã—ç†ç”±å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«
3. [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°é€£å‹•

---

## UIè¨­è¨ˆ

### ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆå…¥ç¨¿ç”»é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ‡ãƒ¼ã‚¿å…¥ç¨¿                           â”‚
â”‚ å…¥ç¨¿ãŒå¿…è¦ãªå•†å“ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â”‚
â”‚ ã—ã¦ãã ã•ã„ã€‚                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ â–¼ QRã‚³ãƒ¼ãƒ‰ã‚­ãƒ¥ãƒ¼ãƒ–ï¼ˆ3å€‹ï¼‰            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 1å€‹ç›®                       â”‚    â”‚
â”‚ â”‚ [Dropzone]                  â”‚    â”‚
â”‚ â”‚ QRã‚³ãƒ¼ãƒ‰ã®URLã‚’å…¥åŠ›          â”‚    â”‚
â”‚ â”‚ [________________]          â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 2å€‹ç›®                       â”‚    â”‚
â”‚ â”‚ [Dropzone]                  â”‚    â”‚
â”‚ â”‚ QRã‚³ãƒ¼ãƒ‰ã®URLã‚’å…¥åŠ›          â”‚    â”‚
â”‚ â”‚ [________________]          â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 3å€‹ç›®                       â”‚    â”‚
â”‚ â”‚ [Dropzone]                  â”‚    â”‚
â”‚ â”‚ QRã‚³ãƒ¼ãƒ‰ã®URLã‚’å…¥åŠ›          â”‚    â”‚
â”‚ â”‚ [________________]          â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚ â–¼ ãƒ­ã‚´ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆ1å€‹ï¼‰               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ [Dropzone]                  â”‚    â”‚
â”‚ â”‚ ãƒ­ã‚´ãƒ‡ãƒ¼ã‚¿ (AI, EPS, PDF)   â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ [ç¢ºèªç”»é¢ã¸é€²ã‚€]              â”‚    â”‚ â† å…¨å…¥ç¨¿å®Œäº†ã§æœ‰åŠ¹åŒ–
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒã‚¤ãƒšãƒ¼ã‚¸å†å…¥ç¨¿ç”»é¢ï¼ˆå·®ã—æˆ»ã—æ™‚ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å†å…¥ç¨¿ãŒå¿…è¦ã§ã™                     â”‚
â”‚                                     â”‚
â”‚ ä»¥ä¸‹ã®å…¥ç¨¿ãƒ‡ãƒ¼ã‚¿ã«å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚  â”‚
â”‚ ä¿®æ­£ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ â–¼ QRã‚³ãƒ¼ãƒ‰ã‚­ãƒ¥ãƒ¼ãƒ–                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 1å€‹ç›® âœ… æ‰¿èªæ¸ˆã¿             â”‚    â”‚
â”‚ â”‚ [ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º]              â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 2å€‹ç›® âŒ å·®ã—æˆ»ã—             â”‚    â”‚
â”‚ â”‚ ç†ç”±: QRã‚³ãƒ¼ãƒ‰ãŒèª­ã¿å–ã‚Œã¾ã›ã‚“ â”‚    â”‚
â”‚ â”‚ [Dropzone] â† å†å…¥ç¨¿å¯èƒ½      â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 3å€‹ç›® âœ… æ‰¿èªæ¸ˆã¿             â”‚    â”‚
â”‚ â”‚ [ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º]              â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ [å†å…¥ç¨¿ã‚’å®Œäº†ã™ã‚‹]            â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### Phase 1: åŸºæœ¬ãƒ•ãƒ­ãƒ¼

| ãƒ†ã‚¹ãƒˆ | æœŸå¾…çµæœ |
|--------|---------|
| å…¥ç¨¿ä¸è¦å•†å“ã®ã¿ã®æ³¨æ–‡ | å…¥ç¨¿ç”»é¢ã‚¹ã‚­ãƒƒãƒ— â†’ ç¢ºèªç”»é¢ã¸ç›´æ¥é·ç§» |
| å…¥ç¨¿å¿…è¦å•†å“1å€‹ | å…¥ç¨¿ã‚¨ãƒªã‚¢1ã¤è¡¨ç¤º |
| å…¥ç¨¿å¿…è¦å•†å“3å€‹ | å…¥ç¨¿ã‚¨ãƒªã‚¢3ã¤è¡¨ç¤º |
| æ··åœ¨æ³¨æ–‡ï¼ˆå…¥ç¨¿å¿…è¦2å€‹ + ä¸è¦1å€‹ï¼‰ | å…¥ç¨¿ã‚¨ãƒªã‚¢2ã¤è¡¨ç¤º |
| æœªå…¥ç¨¿ã§ç¢ºèªç”»é¢ã¸ | ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–ã€é€²ã‚ãªã„ |

### Phase 2: æ”¯æ‰•ã„å¾Œãƒ•ãƒ­ãƒ¼

| ãƒ†ã‚¹ãƒˆ | æœŸå¾…çµæœ |
|--------|---------|
| å…¥ç¨¿ãªã—å•†å“ã®ã¿ â†’ æ”¯æ‰•ã„æˆåŠŸ | status: `confirmed` |
| å…¥ç¨¿ã‚ã‚Š â†’ æ”¯æ‰•ã„æˆåŠŸ | status: `reviewing` |

### Phase 3: Admin å¯©æŸ»

| ãƒ†ã‚¹ãƒˆ | æœŸå¾…çµæœ |
|--------|---------|
| å…¨å…¥ç¨¿æ‰¿èª | æ³¨æ–‡ status: `confirmed` |
| ä¸€éƒ¨å·®ã—æˆ»ã— | æ³¨æ–‡ status: `revision_required` |
| å†å…¥ç¨¿å®Œäº† | æ³¨æ–‡ status: `reviewing` |

---

## æ³¨æ„äº‹é …

- **å¾Œæ–¹äº’æ›æ€§ã¯ä¸è¦**: ECã‚µã‚¤ãƒˆã¯æœªé‹ç”¨ã®ãŸã‚ã€ãƒ¬ã‚¬ã‚·ãƒ¼ã‚³ãƒ¼ãƒ‰ã¯å…¨ã¦å‰Šé™¤ã™ã‚‹
- å¤ã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆ`awaiting_payment`, `paid`, `awaiting_data`, `data_reviewing`ï¼‰ã¯å®Œå…¨å‰Šé™¤
- `quantity_index` ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯1ï¼ˆæ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°å¯¾å¿œï¼‰
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å‹å®šç¾©ã‚‚å¿˜ã‚Œãšã«æ›´æ–°
- æŠ€è¡“çš„è² å‚µã‚’æ®‹ã•ãªã„ã‚ˆã†ã€ä¸è¦ãªã‚³ãƒ¼ãƒ‰ã¯ç©æ¥µçš„ã«å‰Šé™¤ã™ã‚‹

---

## ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: DBãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

| ã‚¿ã‚¹ã‚¯ | çŠ¶æ³ |
|--------|------|
| OrderStatus enum æ›´æ–°ï¼ˆBackendï¼‰ | [x] |
| ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: quantity_index è¿½åŠ  | [x] |
| ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å€¤ç§»è¡Œ | [x] |
| Upload ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ä¿®æ­£ | [x] |
| Frontend å‹å®šç¾©ãƒ»UI æ›´æ–° | [x] |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å®šæ•°ã‚’ shared ã«é›†ç´„ | [x] |

### Phase 2: Backend API

| ã‚¿ã‚¹ã‚¯ | çŠ¶æ³ |
|--------|------|
| OrderItemDTO ã« requires_upload è¿½åŠ  | [x] |
| order_usecase.py ä¿®æ­£ | [x] |
| ç´ä»˜ã‘ API ã« quantity_index å¯¾å¿œ | [x] |
| payment_usecase.py ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ±ºå®šãƒ­ã‚¸ãƒƒã‚¯ç¢ºèª | [x] |
| Admin å¯©æŸ» APIï¼ˆapprove/rejectï¼‰ | [ ] â€»æ–°è¦API |

### Phase 3: Frontend

| ã‚¿ã‚¹ã‚¯ | çŠ¶æ³ |
|--------|------|
| OrderItem å‹ã« requires_upload è¿½åŠ  | [x] |
| CheckoutContainer åˆ†å²ãƒ­ã‚¸ãƒƒã‚¯ | [x] |
| CheckoutUploadContainer å…¨é¢æ”¹ä¿® | [x] |
| å…¥ç¨¿å®Œäº†ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | [x] |
| useLinkUploads ãƒ•ãƒƒã‚¯ä¿®æ­£ | [x] |
| UploadType ã‚’ shared ã«é›†ç´„ | [x] |

### Phase 4: ãƒã‚¤ãƒšãƒ¼ã‚¸ãƒ»Admin

| ã‚¿ã‚¹ã‚¯ | çŠ¶æ³ |
|--------|------|
| ãƒã‚¤ãƒšãƒ¼ã‚¸å†å…¥ç¨¿ç”»é¢ï¼ˆæ•°é‡ãƒ™ãƒ¼ã‚¹å¯¾å¿œï¼‰ | [ ] |
| Admin å¯©æŸ» APIï¼ˆapprove/rejectï¼‰ | [ ] |
| Admin å¯©æŸ»ç”»é¢ã®æ‰¿èª/å·®ã—æˆ»ã—å®Ÿè£… | [ ] |
| å·®ã—æˆ»ã—ç†ç”±å…¥åŠ› | [ ] |
